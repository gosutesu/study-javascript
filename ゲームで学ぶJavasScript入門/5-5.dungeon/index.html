<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <style>
        #maze {
            width: 900px;
            height: 600px;
            touch-action: none;
        }
        #START {
            position: absolute;
            left: 200px;
            top:200px;
        }
    </style>
    <script>
        "use strict";

        var W = 31,H = 31,GAMECLEAR = 1,GAMEOVER = 2;
        var ctx, keyCode = 0,maze = [],player,aliens = [];
        var timer = NaN, status = 0;

        var scroller = new Scroller();
        Player.prototype = scroller;
        Alien.prototype = scroller;

        /**
         * スクロール処理オブジェクト
         */
        function Scroller() {
            this.doScroll = function() {
                
                if(this.dx == 0 && this.dy == 0 ) {
                    return;
                }

                if(++this.scrollCount >= 5) {
                    this.x = this.x + this.dx;
                    this.y = this.y + this.dy;
                    this.dx = 0;
                    this.dy = 0;
                    this.scrollCount = 0;
                }
            }

            this.getScrollX = function() {
                return this.x * 50 + this.dx * this.scrollCount * 10;
            }

            this.getScrollY = function() {
                return this.y * 50 + this.dy * this.scrollCount *10;
            }
        }

        /**
         * 主人公オブジェクトコンストラクタ
         */
        function Player(x,y) {
            this.x = x;
            this.y = y;
            this.dx = 0;
            this.dy = 0;
            this.dir = 0;
            this.scrollCount = 0;

            this.update = function() {
                this.doScroll();
                
                if(this.scrollCount > 0 ) {
                    return;
                }

                if(this.x == W - 2 && this.y == W-2 ) {
                    clearInterval(timer);
                    status = GAMECLEAR;
                    document.getElementById("bgm").pause();
                    repaint();
                }

                this.dx = 0;
                this.dy = 0;
                var nx = 0,ny = 0;
                switch(keyCode) {
                    case 37 :
                        nx = -1;
                        ny = 0;
                        this.dir = 2;
                    break;
                    case 38:
                        nx = 0;
                        ny = -1;
                        this.dir = 0;
                    break;
                    case 39:
                        nx = +1;
                        ny = 0;
                        this.dir = 1;
                    break;
                    case 40:
                        nx = 0;
                        ny = +1;
                        this.dir = 1;
                    break;

                }

                if(mase[this.y + ny][this.x + nx] == 0) {
                    this.dx = nx;
                    this.dy = ny;
                }
            }

            this.paint = function(gc,x,y,w,h) {
                var img = document.getElementById("hero" + this.dir);
                gc.drawImage(img,x,y,w,h);
            }
        }
         
    </script>
</head>
<body onload="init()">
    <audio src="Emergency.mp3" id="bgm" loop="loop"></audio>
    <canvas id="maze" width="900" height="600"></canvas>
    <img id="START" src="start.png" onclick="go()" /><br />
    <img id="arrows" src="arrows.png" style="display:none" />

    <img id="hero0" src="hero0.png" style="display:none" />
    <img id="hero1" src="hero1.png" style="display:none" />
    <img id="hero2" src="hero2.png" style="display:none" />
    <img id="hero3" src="hero3.png" style="display:none" />

    <img id="alien0" src="alien0.png" style="display:none" />
    <img id="alien1" src="alien1.png" style="display:none" />
    <img id="alien2" src="alien2.png" style="display:none" />
    <img id="alien3" src="alien3.png" style="display:none" />

</body>
</html>